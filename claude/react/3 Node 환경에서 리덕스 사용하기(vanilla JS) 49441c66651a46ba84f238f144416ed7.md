# 3. Node 환경에서 리덕스 사용하기(vanilla JS)

**최종 코드**

[vanilla.zip](vanilla.zip)

이제 Node 환경에서 작업해보도록 하겠습니다. **이번 챕터에서 React는 사용하지 않습니다.**

## 1. **Project Setup**

- 편의를 위해서 `Create-react-app`에서 코드를 작성합니다.
    
    ```bash
    npx create-react-app vanilla-redux --template basic-react
    cd vanilla-redux
    ```
    

- 리덕스 설치하기
    
    ```bash
    npm i redux
    ```
    

- 실행하기
    
    ```bash
    npm start
    ```
    

## 2. 리덕스 없이 구현해보기

![Untitled](Untitled%2064.png)

```html
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>React App</title>
    </head>
    <body>
        <!-- <div id="root"></div> -->
        <h1>Product Detail</h1>
        <h2>딥러닝 개발자 무릎 담요</h2>
        <span><strong>17,500</strong>원</span>
        <div id="counter-box">
            <button type="button" id="minus" disabled>MINUS</button>
            <span id="number">0</span>
            <button type="button" id="plus">PLUS</button>
        </div>
        <div>총 수량 <strong id="quantity">0</strong></div>
        <div><strong id="total">0</strong>원</div>
    </body>
</html>
```

```jsx
const plus = document.getElementById("plus");
const minus = document.getElementById("minus");
const number = document.getElementById("number"); // 수량
const quantity = document.getElementById("quantity"); // 페이지 하단에 총 수량
const totalPrice = document.getElementById("total"); // 페이지 하단에 총 가격

const PRICE = 17500;

let count = 0;

// UI Update - text
const updateResult = (c) => {
    number.innerText = count;
    quantity.innerHTML = c;
    totalPrice.innerHTML = c * PRICE;
};

// State Change
const addNumber = () => {
    count += 1;
    minus.disabled = false;
    updateResult(count);
};

// State Change
const substractNumber = () => {
    count -= 1;
    if (count <= 0) {
        minus.disabled = true;
    }
    updateResult(count);
};

// Init
number.innerHTML = count;
updateResult(count);

// Event
plus.addEventListener("click", addNumber);
minus.addEventListener("click", substractNumber);
```

Count를 Vanila JS로 구현해본다면 클릭 이벤트가 발생할 때마다 count의 상태값을 직접 수정한 후, HTML을 업데이트 해줍니다. 

## 3. 리덕스로 구현해보기

위에서 구현한 기능을 리덕스를 사용해서 구현해 봅시다!

1. `createStore`를 사용하여 store를 생성합니다.

```jsx
import { createStore } from "redux";

const plus = document.getElementById("plus");
const minus = document.getElementById("minus");
const number = document.getElementById("number");
const quantity = document.getElementById("quantity");
const totalPrice = document.getElementById("total");

const PRICE = 17500;

// create Store
const store = createStore(countReducer);
```

1. store의 상태값을 수정할 `reducer` 함수를 만들어줍니다.

```jsx
import { createStore } from "redux";

const plus = document.getElementById("plus");
const minus = document.getElementById("minus");
const number = document.getElementById("number");
const quantity = document.getElementById("quantity");
const totalPrice = document.getElementById("total");

const PRICE = 17500;

// Reducer
const countReducer = (state = 0, action) => { // state 초기화
  switch (action.type) {  // switch문
    case "ADD":
      return state + 1;
    case "SUBSTRACT":
      return state - 1;
    default:
      return state;
  }
};

// create Store
const store = createStore(countReducer);
```

함수 `reducer`에서 `if - else`문을 사용해도 되지만 좀 더 직관적인 `switch`문을 많이 사용합니다

1. dispatch를 사용하여 reducer에게 action을 넘겨줄 함수들을 만듭니다.

```jsx
import { createStore } from "redux";

const plus = document.getElementById("plus");
const minus = document.getElementById("minus");
const number = document.getElementById("number");
const quantity = document.getElementById("quantity");
const totalPrice = document.getElementById("total");

const PRICE = 17500;

// Action
const addNumber = () => {
    store.dispatch({ type: "ADD" });
    minus.disabled = false;
};

//Action
const substractNumber = () => {
    store.dispatch({ type: "SUBSTRACT" });
    if (store.getState() <= 0) {
        minus.disabled = true;
    }
};

// Reducer
const countReducer = (state = 1, action) => {
  switch (action.type) {
    case "ADD":
      return state + 1;
    case "SUBSTRACT":
      return state - 1;
    default:
      return state;
  }
};

// create Store
const store = createStore(countReducer);

// Event
plus.addEventListener("click", addNumber);
minus.addEventListener("click", substractNumber);
```

1. subscribe를 사용하여 state의 변화가 감지될 때마다 UI를 업데이트 시켜줄 함수를 만듭니다.

```jsx
import { createStore } from "redux";

const plus = document.getElementById("plus");
const minus = document.getElementById("minus");
const number = document.getElementById("number");
const quantity = document.getElementById("quantity");
const totalPrice = document.getElementById("total");

const PRICE = 17500;

// Action
const addNumber = () => {
  store.dispatch({ type: "ADD" });
};

//Action
const substractNumber = () => {
  store.dispatch({ type: "SUBSTRACT" });
};

// Reducer
const countReducer = (state = 1, action) => {
  switch (action.type) {
    case "ADD":
      return state + 1;
    case "SUBSTRACT":
      return state - 1;
    default:
      return state;
  }
};

// create Store
const store = createStore(countReducer);

const handleWrite = () => {
  number.innerText = store.getState();
  quantity.innerText = store.getState();
  totalPrice.innerText = store.getState() * PRICE;
  console.log(store.getState());
};

// Update UI
store.subscribe(handleWrite);

// Event
plus.addEventListener("click", addNumber);
minus.addEventListener("click", substractNumber);
```