# 5. 리덕스 툴킷

**최종 실행 코드**

[my-app-2.zip](my-app-2.zip)

# 1. 리덕스 툴킷이란?

리덕스 공식 팀에서 만든 툴입니다. 리덕스 관련된 툴이 묶여있습니다. 예를 들어 앞에서 설치했었던 redux-devtools-extension 등이 tooltik 안에 모두 내장되어 있습니다. (우리가 배우진 않았지만 thunk(썽크), immer(이머) 등도 내장되어 있습니다.)

[Redux Toolkit | Redux Toolkit](https://redux-toolkit.js.org/)

# 2. 설치하기

우리 프로젝트에 그대로 설치하도록 하겠습니다. toolkit에는 redux가 자동으로 설치됩니다. 따라서 redux는 별도로 설치할 필요가 없습니다.

```bash
npm install @reduxjs/toolkit
# npm install @reduxjs/toolkit react-redux //react-redux를 설치안하셨다면 함께 설치해주세요.
```

[Quick Start | Redux Toolkit](https://redux-toolkit.js.org/tutorials/quick-start#create-a-redux-state-slice)

# 3. 구현하기

가장 먼저 modules/goodsCounter.jsx를 수정해주도록 하겠습니다. 기존에 있던 코드와 비교하기 위해 기존에 있던 코드를 주석처리 하였습니다.

가장 큰 차이점을 열거하자면 아래와 같습니다.

- 리듀서의 사용법이 간소화되었습니다. 액션 생성 함수가 리듀서 안에 통합되었습니다. 객체 안에서 직접적으로 선언되었던 타입도 사라졌습니다.
- 객체 불변성을 위한 …state가 없어졌습니다. (내장되어 있는 immer 라이브러리를 사용합니다.)

```jsx
import {createSlice} from '@reduxjs/toolkit' 

// 액션 생성함수
// export const addNumber = () => {
//     return { type: "ADD" };
// };

// export const substractNumber = () => {
//     return { type: "SUBSTRACT" };
// };

// // 초기 값
// const initialState = {
//     stock: 10,
//     goods: 1
// };

// // 리듀서
// const goodsReducer = (state = initialState, action) => {
//     console.log(action)
//     console.log(action.type)
//     console.log(state)
//     switch (action.type) {
//         case "ADD":
//             return {
//                 ...state,
//                 stock : state.stock - 1,
//                 goods : state.goods + 1,
//             }
//         case "SUBSTRACT":
//             return {
//                 ...state,
//                 stock : state.stock + 1,
//                 goods : state.goods - 1,
//             }
//         default:
//             return state;
//     }
// };

// export default goodsReducer;

const initialState = {
    stock: 10,
    goods: 1
};

// slice 를 생성합니다. slice 는 하나의 store를 이름 그대로 조금 잘라내어 사용한다고 보시면 됩니다.
export const counterSlice = createSlice({
    name: 'counter', // 이 슬라이스의 이름
    initialState,
    reducers: { 
				// 액션의 모습이 객체에서 함수로 바뀌었습니다. 함수로 변경되면서 액션의 선언과 리듀서에 들어있던 액션의 타입에서 해야할 일들에 대한 내용이 통합되어 작성하게 변경되었습니다.
        increment: (state) => {
            state.stock -= 1 // 기존의 state 를 유지하는 코드가 필요 없어졌습니다.
            state.goods += 1
        },
        decrement: (state) => {
            state.stock += 1
            state.goods -= 1
        },
    },
})

// createSlice 함수로 만들어진 couterSlice 객체에는 리듀서와 액션 생성함수가 모두 포함되어 있습니다.
console.log(counterSlice);

// 각 리듀서 함수에 대해 자동으로 액션 생성자가 생성됩니다.
export const { increment, decrement } = counterSlice.actions

// 리듀서 입니다.
export default counterSlice.reducer
```

또한 아래 index.js 처럼 리듀서 모듈을 합쳐 주었던 함수(combineReducers)가 없어졌습니다. 이제 최상위 index.js에서 불러와 configureStore안에서 스토어 생성과 동시에 합쳐줄 수 있게 되었습니다.

가장 큰 차이점을 열거하자면 아래와 같습니다.

- 별도로 combineReducers함수를 사용할 필요 없어졌습니다.
- createStore가 configureStore로 대체되었습니다.
- thunk, composeWithDevTools 등에 필수로 필요한 모듈들이 내장되었습니다.

```jsx
import React from 'react';
// import ReactDOM from 'react-dom'; //구버전
import { createRoot } from 'react-dom/client';
import App from './App';
import { createStore } from 'redux';
// import rootReducer from './modules';
import goodsReducer from './modules/goodsCounter';
import stockReducer from './modules/stockCounter';
import { Provider } from 'react-redux';
import { composeWithDevTools } from 'redux-devtools-extension'; // 리덕스 개발자 도구
import { configureStore } from '@reduxjs/toolkit' //toolkit

// const store = createStore(rootReducer, composeWithDevTools());
// 1. 항상 리듀서를 combine을 해주었어야 했지만 이제 스토어 생성과 동시에 리듀서를 합치는게 가능해졌습니다.
// 2. thunk(비동기 처리를 도와주는 라이브러리), immer(불변성 처리 라이브러리) composeWithDevTools 등에 필요한 것들을 추가해주었어야 했지만 그럴 필요가 없습니다.
const store = configureStore({
    reducer: {
        goodsReducer,
        stockReducer
    },
})
console.log(store.getState());

const container = document.getElementById('root');
const root = createRoot(container);
root.render(
    <Provider store={store}>
        <App tab="home" />
    </Provider>,
);
```

App.js에서는 StockCounter를 비활성화 하도록 하겠습니다.

```jsx
import GoodsCounter from "./components/GoodsCounter";
// import StockCounter from "./components/StockCounter";

function App() {
  return (
    <div className="App">
      <h1>test2</h1>
      <GoodsCounter/>
      {/* <StockCounter/> */}
    </div>
  );
}

export default App;
```

마지막으로 GoodsCounter.jsx는 아래와 같습니다. 크게 달라진 코드는 없습니다. 우리 코드에는 없지만 state 변경을 위해 객체 형식(payload, 예를 들어 `{type: 'ADD', value:'100'}`)으로 전달해주는 코드가 있다면 `dispatch(increment());` 안에 아규먼트로 넣어주면 됩니다.

```jsx
import { useSelector, useDispatch } from 'react-redux';
import { increment, decrement } from '../modules/goodsCounter';

function GoodsCounter(){

    // useSelector : store의 상태 조회 Hook
    const { stock, goods } = useSelector(state => {
        console.log('-start-')
        console.log(state)
        console.log('-end-')

        return ({
            stock: state.goodsReducer.stock,
            goods: state.goodsReducer.goods
        })
    }
    );
    console.log(stock, goods);

    // useDispatch : store의 dispatch를 함수 내부에서 사용할 수 있는 Hook
    const dispatch = useDispatch();

    const onAddNumber = () => dispatch(increment());
    const onSubstractNumber = () => dispatch(decrement());

    return (
        <div>
            <h2>딥러닝 개발자 무릎 담요</h2>
            <span>
                <strong>17,500</strong>원
            </span>
            <div id="counter-box">
                <button type="button" onClick={onSubstractNumber}>
                MINUS
                </button>
                <span>{goods}</span>
                <button onClick={onAddNumber}>
                PLUS
                </button>
            </div>
            <div>
                총 수량 <strong>{goods}</strong>
            </div>
            <div>
                <strong>{goods * 17500}</strong>원
            </div>
            <div>
                재고 <strong>{stock}</strong>
            </div>
        </div>
    )
}

export default GoodsCounter;
```